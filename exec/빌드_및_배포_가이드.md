# ì‹¤í–‰ ê°€ì´ë“œ

í•´ë‹¹ ê°€ì´ë“œëŠ” ë¡œì»¬ì—ì„œ Git ì†ŒìŠ¤ í´ë¡  í›„ ë¹Œë“œ ë° ë°°í¬ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡ ë²„ì „ ì •ë³´

| Node | 14.17.0 |
| --- | --- |
| npm | 6.14.13 |
| JDK | 1.8 |
| Mysql | 8.0.28 |
| Spring boot | 2.5.10 |
| STS | 3.9.14 |
| lombok | 1.8.22 |
</aside>



## 1. Git clone

```bash
$ git clond https://lab.ssafy.com/s06-ai-image-sub2/S06P22A204.git
```

## 2. DB

> DBëŠ” ec2-ubuntuì— ì˜¬ë ¤ì„œ ì›ê²© DBë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤
> 
> 
> ëª¨ë“  ëª…ë ¹ì–´ëŠ” ec2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤
> 

### 2-1. Mysql ì„¤ì¹˜

```powershell
# ubuntu íŒ¨í‚¤ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
$ sudo apt update

# mysql ì„¤ì¹˜
$ sudo apt install mysql-server #ì„¤ì¹˜ê³¼ì •ì—ì„œ y/nì„ ë¬»ëŠ” ë¬¸êµ¬ê°€ ë‚˜ì˜¤ë©´, yë¥¼ ì…ë ¥í•˜ì—¬ ì„¤ì¹˜

# mysql ì„¤ì¹˜ í™•ì¸
$ dpkg -l grep mysql-server
```

<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/2f0d8209-a857-4d28-a8d3-99886e34d872/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220408%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220408T013237Z&X-Amz-Expires=86400&X-Amz-Signature=4030f2237e86a901fbdf38b68f9e09439c708680b1bfe87d36cde467500b80f9&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

```powershell
# mysql ì‹¤í–‰ì—¬ë¶€ í™•ì¸
$ sudo netstat -tap | grep mysql
```

ìœ„ ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ `sudo: netstat: command not found` ê°€ ëœ¬ë‹¤ë©´

```powershell
$ sudo apt install net-tools
```

ë‹¤ì‹œ `sudo netstat -tap | grep mysql` ëª…ë ¹ì–´ ì‹¤í–‰ì‹œ


<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/2f0d8209-a857-4d28-a8d3-99886e34d872/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220408%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220408T014031Z&X-Amz-Expires=86400&X-Amz-Signature=435b56043ac0b2caf8474bd684d178fe4c0203dd238fbff69ab3ed0c696a50e5&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject>

ì‹¤í–‰ì¤‘ì„ì„ í™•ì¸

### 2-2. mysql ì™¸ë¶€ ì ‘ì† ì„¤ì •

```powershell
# mysql.conf.d ë””ë ‰í† ë¦¬ ì´ë™
$ cd /etc/mysql/mysql.conf.d

# mysqld.cnf íŒŒì¼ ìˆ˜ì •
$ sudo vi mysqld.cnf
# bind-addressë¥¼ 127.0.0.1 -> 0.0.0.0 ìœ¼ë¡œ ë³€ê²½
```

```sql
# mysqlì— ì ‘ì†
$ sudo mysql

# ì™¸ë¶€ ì ‘ì† ê³„ì • ìƒì„± & ê¶Œí•œ ë¶€ì—¬
create user 'ê³„ì •ì´ë¦„'@'%' identified by 'íŒ¨ìŠ¤ì›Œë“œ';
grant all privileges on *.* to 'ê³„ì •ì´ë¦„'@'%' with grant option;
grant all privileges on *.* to 'ê³„ì •ëª…'@'%'; 
flush privileges;
```

```sql
# mysql ì¬ì‹œì‘
$ sudo service mysql restart
```

### 2-3. workbenchì—ì„œ ì ‘ì† í™•ì¸

<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/31e857dd-e8c6-4f7d-99b5-318b971b4793/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220408%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220408T014055Z&X-Amz-Expires=86400&X-Amz-Signature=8887e988fb221f418ed7c650fb17217fc2f4c4e3762c5912d5584f8abedf621f&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

| connection name | sayeon |
| --- | --- |
| hostname  | 13.124.83.47 |
| username  | sayeon |
| password  | sayeon204 |
- ë¡œì»¬ì—ì„œ DB ì‚¬ìš©ì‹œ
    
    mysql workbenchì— ë‹¤ìŒ sql ì‹¤í–‰ì‹œì¼œ ìŠ¤í‚¤ë§ˆ ë° í…Œì´ë¸”ì„ ìƒì„±
    
    `mysql ë²„ì „ - 8.0.28` (ë²„ì „ì´ ë‚®ì„ ê²½ìš° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì•ˆë  ìˆ˜ ìˆìŒ)
    
    [sayeonStructure.sql](%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20%E1%84%80%E1%85%A1%E1%84%8B%2038456/sayeonStructure.sql)
    
    server/src/main/resources/application.properties ì—ì„œ ì•„ë˜ ë‚´ìš© ìˆ˜ì •
    
    ```bash
    spring.datasource.url=jdbc:mysql://localhost:3306/sayeon?&autoReconnect=true&failOverReadOnly=false&maxReconnects=10&allowPublicKeyRetrieval=true&useSSL=false&useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Seoul&zeroDateTimeBehavior=convertToNull&rewriteBatchedStatements=true
    spring.datasource.hikari.username={ë³¸ì¸ì´ ìƒì„±í•œ ê³„ì •ëª… or root}
    spring.datasource.hikari.password={ìƒì„±í•œ ê³„ì • ë¹„ë°€ë²ˆí˜¸ or root ë¹„ë°€ë²ˆí˜¸}
    ```
    

## 3. Server

### 3-1. Project import

File > import > Maven > Existing Maven Projects

Root Directoryì—ì„œ í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ server í´ë” ì„ íƒ > pom.xml ì„ íƒ > Finish

<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/67407578-b3a0-4c12-83ba-a74f2db474f8/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220408%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220408T014114Z&X-Amz-Expires=86400&X-Amz-Signature=9b76dd2448a32bb235df9b00d82c6e64ff68832d6d33e5c0176e865e5b8abd67&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

### 3-2. Project run

í”„ë¡œì íŠ¸ ìš°í´ë¦­ > Run as > Spring Boot App

### 3-3. ì—ëŸ¬ ë°œìƒ ì‹œ ì²´í¬í•´ì•¼í•  ë¶€ë¶„!

- í”„ë¡œì íŠ¸ ìš°í´ë¦­ > properties > ì¢Œì¸¡ â€˜Java Build Pathâ€™ > Libraries íƒ­ > JRE System Libraryê°€ `JavaSE-1.8` ì¸ì§€ í™•ì¸ (JavaSE-1.8 ì´ ì•„ë‹Œê²½ìš° ë”ë¸”í´ë¦­í•˜ì—¬ ë³€ê²½)
    
    <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/0172452a-2d33-42d2-9d08-b54633085843/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220408%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220408T014138Z&X-Amz-Expires=86400&X-Amz-Signature=90a72a06cf3e5060d3894d0249faa7c1a5248983179b3a534a642ee113efd59f&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
    
- í”„ë¡œì íŠ¸ ìš°í´ë¦­ > Maven > Update project
- lombok ì„¤ì¹˜ í™•ì¸ ë° STSì— lombok ì„¤ì¹˜ í–ˆëŠ”ì§€ í™•ì¸

## 4. Client

### 4-1. NodeJS ì„¤ì¹˜

**[http://nodejs.org/en/](http://nodejs.org/en/)**

ì„¤ì¹˜ ì™„ë£Œ í›„ cmdì—ì„œ ë²„ì „ í™•ì¸

```bash
$ node -v
$ npm -v
```

### 4-2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

client í´ë”ì— `.env` íŒŒì¼ ìƒì„±

```bash
REACT_APP_BASE_URL=https://j6a204.p.ssafy.io:8443/api/
REACT_APP_S3_ACCESS_KEY={s3 access key}
REACT_APP_S3_SECRET_ACCESS_KEY={s3 secret access key}
REACT_APP_AZURE_COMPUTER_VISION_KEY={azure computer vision key}
REACT_APP_AZURE_COMPUTER_VISION_ENDPOINT={azure computer vision endpoint}
```

### 4-3. íŒ¨í‚¤ì§€ ì„¤ì¹˜ + ì‹¤í–‰

```bash
$ npm install
$ npm start
```

## 5. ë¹Œë“œ ë° ë°°í¬

> ec2-ubuntu ì¸ìŠ¤í„´ìŠ¤ì—ì„œ git clone í›„ ë¹Œë“œ ë° ë°°í¬í•˜ì˜€ìŠµë‹ˆë‹¤.
> 
> 
> ec2 ì¸ìŠ¤í„´ìŠ¤ ìœ„ì— ë‹¤ìŒ í•­ëª©ë“¤ì´ ì„¤ì¹˜ë˜ì–´ìˆì–´ì•¼í•©ë‹ˆë‹¤. [(ì°¸ê³ )](https://tobegood.tistory.com/entry/Nginx%EB%A1%9C-React%EB%A5%BC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0-%EC%9A%B0%EB%B6%84%ED%88%AC-%ED%99%98%EA%B2%BD)
> 
- nodejs, npm
- git
- nginx

```bash
[ë°±ì—”ë“œ ë¹Œë“œ ë° ë°°í¬]
cd ~/app/sayeon/S06P22A204/server
./mvnw clean package
cd target
nohup java -jar server-0.0.1-SNAPSHOT.jar & > /dev/null

#ì¬ë°°í¬ì‹œ
ps -ef | grep java
sudo kill -9 í¬íŠ¸ë²ˆí˜¸
git pull
cd ~/app/sayeon/S06P22A204/server
./mvnw clean package
cd ~/app/sayeon/S06P22A204/server/target
nohup java -jar server-0.0.1-SNAPSHOT.jar & > /dev/null

[í”„ë¡ íŠ¸ ë¹Œë“œ ë° ë°°í¬]
cd ~/app/sayeon/S06P22A204/client
npm run build

# ì¬ë°°í¬ì‹œ
cd ~/app/sayeon/S06P22A204/client
git pull
rm -rf build
npm run build
```

- `sh /home/ubuntu/start_test.sh` ëª…ë ¹ì–´ ì‚¬ìš©ì‹œ ë°±ì—”ë“œ ë¹Œë“œ ë° ë°°í¬ í•œë²ˆì— ê°€ëŠ¥
    
    /home/ubuntu/start_test.sh
    
    ```bash
    !#/bin/bash
    REPOSITORY=/home/ubuntu/app/sayeon/S06P22A204
    
    cd $REPOSITORY/server/
    
    echo "> Git Pull"
    
    git pull
    
    echo "> í”„ë¡œì íŠ¸ build ì‹œì‘"
    
    ./mvnw clean package
    
    echo "Start Spring Boot Application!"
    CURRENT_PID=$(ps -ef | grep java | grep server | awk '{print $2}')
    echo "$CURRENT_PID"
    
     if [ -z $CURRENT_PID ]; then
    echo ">í˜„ì¬ êµ¬ë™ì¤‘ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    
    else
    echo "> kill -9 $CURRENT_PID"
    kill -9 $CURRENT_PID
    sleep 10
    fi
     echo ">ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì§„í–‰!"
    nohup java -jar /home/ubuntu/app/sayeon/S06P22A204/server/target/server-0.0.1-SNAPSHOT.jar & > /dev/null
    ```
